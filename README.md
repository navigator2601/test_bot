![Логотип проекту](images/logo.jpg)

```markdown
# Проєкт Refridex OS

## Опис проєкту

Це Telegram-бот, розроблений на основі `aiogram` та `asyncpg`, з інтеграцією `Telethon` для роботи з Telegram API. Основна функціональність полягає у наданні інформації про кондиціонери, управління каталогом та користувачами через адміністративну панель.

## Структура проєкту

Проєкт має наступну логічну та ієрархічну структуру:

```

.
├── common/
├── config.py
├── database/
├── filters/
├── handlers/
│   ├── admin/
├── images/
├── keyboards/
├── main.py
├── middlewares/
├── telegram\_client\_module/
└── utils/

```

### Детальний опис каталогів та файлів

#### `common/`
Цей каталог містить загальні модулі, які використовуються в усьому проєкті.

-   **`constants.py`**: Конфігураційні константи, які використовуються в проєкті. Містить API-ключі, ідентифікатори, шляхи та інші статичні значення.
-   **`messages.py`**: Централізоване сховище текстових повідомлень для бота. Покращує підтримку та локалізацію, відокремлюючи текст від логіки.
-   **`states.py`**: Визначення станів для FSM (Finite State Machine). Використовується для керування потоками діалогів з користувачем.

#### `config.py`
-   **`config.py`**: Завантаження та управління конфігурацією проєкту. Зчитує змінні оточення з `.env` файлу та робить їх доступними.

#### `database/`
Цей каталог відповідає за взаємодію з базою даних PostgreSQL.

-   **`db_pool_manager.py`**: Менеджер пулу з'єднань до бази даних PostgreSQL. Забезпечує ефективне та безпечне керування підключеннями.
-   **`db_search_functions.py`**: Функції для виконання SQL-запитів до бази даних. Містить логіку для пошуку та отримання даних про товари та їх характеристики.
-   **`show_db_data.py`**: Допоміжні скрипти для відображення даних з бази даних. Використовуються для налагодження та перевірки вмісту таблиць.
-   **`show_schema_structure.py`**: Допоміжні скрипти для відображення структури схеми бази даних. Використовуються для візуалізації таблиць та їх зв'язків.
-   **`telethon_chats_db.py`**: Функції для взаємодії з таблицею `telethon_chats`, що зберігає інформацію про чати Telethon.
-   **`telethon_sessions_db.py`**: Функції для взаємодії з таблицею `telethon_sessions`, яка керує сесіями Telethon клієнтів.
-   **`update_models_cond.py`**: Скрипти для оновлення даних про моделі кондиціонерів. Використовуються для імпорту нових або оновлення існуючих даних.
-   **`users_db.py`**: Функції для взаємодії з таблицею `users`, що зберігає дані про користувачів бота.

#### `filters/`
-   **`admin_filter.py`**: Фільтр для перевірки прав доступу користувача. Забезпечує, що лише адміністратори можуть отримати доступ до певних хендлерів.

#### `handlers/`
Цей каталог містить обробники подій (хендлери) для різних команд і дій користувачів.

-   **`handlers/admin/`**:
    -   **`chat_matrix_handlers.py`**: Хендлери для функціоналу "матриці чатів" в адмін-панелі. Дозволяє адміністратору керувати взаємодією з чатами Telethon.
    -   **`main_menu.py`**: Хендлери для головного меню адмін-панелі. Обробляє команди та кнопки, що ведуть до адміністративних функцій.
    -   **`telethon_operations.py`**: Хендлери для управління Telethon клієнтами в адмін-панелі. Забезпечує функції для додавання, видалення та перевірки сесій.
    -   **`user_management.py`**: Хендлери для управління користувачами бота в адмін-панелі. Дозволяє адміністратору переглядати та редагувати інформацію про користувачів.
-   **`catalog_handler.py`**: Хендлери для обробки запитів, пов'язаних з каталогом товарів. Відповідає за навігацію по брендах, моделях та відображення інформації.
-   **`echo_handler.py`**: Хендлер для обробки невідомих повідомлень і команд. Відправляє відповідь, якщо вхідне повідомлення не відповідає іншим хендлерам.
-   **`menu_handler.py`**: Хендлер для відображення головного меню бота. Керує переходом до основних функцій бота.
-   **`start_handler.py`**: Хендлер для обробки команди `/start`. Обробляє перше звернення користувача до бота, реєструє його та відображає привітання.

#### `keyboards/`
-   **`admin_keyboard.py`**: Функції для створення клавіатур адмін-панелі. Генерує inline- та reply-клавіатури для адміністративних функцій.
-   **`callback_factories.py`**: Визначає `CallbackData` для обробки inline-кнопок. Забезпечує структуровану передачу даних через кнопки.
-   **`inline_keyboard.py`**: Функції для створення inline-клавіатур. Використовуються для інтерактивних елементів в каталозі.
-   **`reply_keyboard.py`**: Функції для створення звичайних клавіатур. Використовуються для головного меню бота.

#### `main.py`
-   **`main.py`**: Головний файл запуску бота. Містить ініціалізацію об'єктів `Bot` та `Dispatcher`, реєстрацію роутерів, middleware, а також функції для запуску та зупинки бота.

#### `middlewares/`
Цей каталог містить проміжне програмне забезпечення (middleware), яке обробляє події до того, як вони потраплять до хендлерів.

-   **`db_middleware.py`**: Middleware для додавання сесії бази даних в `data` об'єкт хендлерів. Забезпечує доступ до пулу з'єднань безпосередньо в обробниках.
-   **`dependencies.py`**: Визначення залежностей, які використовуються в Middleware. Дозволяє керувати об'єктами, що передаються в обробники.
-   **`exception_middleware.py`**: Middleware для централізованої обробки помилок. Перехоплює винятки, щоб запобігти збою бота та повідомити адміністратора.
-   **`telethon_middleware.py`**: Middleware для додавання Telethon клієнта в `data` об'єкт хендлерів. Забезпечує доступ до Telethon клієнтів з будь-якого хендлера.

#### `telegram_client_module/`
-   **`auth_telethon.py`**: Модуль для аутентифікації Telethon клієнтів. Керує процесом авторизації та отримання сесій.
-   **`telethon_client.py`**: Менеджер для управління Telethon клієнтами. Забезпечує завантаження, ініціалізацію та доступ до клієнтів з пулу.

#### `utils/`
-   **`auth_check.py`**: Утиліти для перевірки прав доступу користувача. Допоміжні функції для визначення рівня доступу користувачів.
-   **`logger.py`**: Модуль для налаштування логування в проєкті. Забезпечує єдиний формат логів та їх централізоване керування.
-   **`set_bot_commands.py`**: Утиліта для встановлення команд бота в Telegram. Дозволяє програмно задавати команди, які відображаються в інтерфейсі бота.

```
