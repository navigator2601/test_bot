[Refridex OS • УВАГА • 2025-09-18 00:12:51.945] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 00:12:51.955] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:12:51.955] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:12:51.955] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:12:51.956] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:12:51.956] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:12:51.956] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:12:51.956] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:12:51.956] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:12:51.957] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:12:51.957] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 00:12:52.207] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:12:52.208] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 00:12:52.210] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • DEBUG • 2025-09-18 00:13:02.161] 🐞 Відлагодження: parso.python.diff • diff parser start
[Refridex OS • DEBUG • 2025-09-18 00:13:02.161] 🐞 Відлагодження: parso.python.diff • line_lengths old: 2; new: 79
[Refridex OS • DEBUG • 2025-09-18 00:13:02.161] 🐞 Відлагодження: parso.python.diff • -> code[insert] old[1:0] new[1:2]
[Refridex OS • DEBUG • 2025-09-18 00:13:02.162] 🐞 Відлагодження: parso.python.diff • parse_part from 1 to 4 (to 5 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:13:02.162] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[1:1] new[3:3]
[Refridex OS • DEBUG • 2025-09-18 00:13:02.162] 🐞 Відлагодження: parso.python.diff • -> code[insert] old[2:1] new[4:78]
[Refridex OS • DEBUG • 2025-09-18 00:13:02.169] 🐞 Відлагодження: parso.python.diff • parse_part from 5 to 78 (to 78 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:13:02.169] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[2:2] new[79:79]
[Refridex OS • DEBUG • 2025-09-18 00:13:02.169] 🐞 Відлагодження: parso.python.diff • parse_part from 79 to 79 (to 78 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:13:02.169] 🐞 Відлагодження: parso.python.diff • diff parser end
[Refridex OS • DEBUG • 2025-09-18 00:15:34.027] 🐞 Відлагодження: parso.python.diff • diff parser start
[Refridex OS • DEBUG • 2025-09-18 00:15:34.028] 🐞 Відлагодження: parso.python.diff • line_lengths old: 79; new: 65
[Refridex OS • DEBUG • 2025-09-18 00:15:34.028] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[1:59] new[1:59]
[Refridex OS • DEBUG • 2025-09-18 00:15:34.029] 🐞 Відлагодження: parso.python.diff • copy old[4:78] new[1:42]
[Refridex OS • DEBUG • 2025-09-18 00:15:34.032] 🐞 Відлагодження: parso.python.diff • parse_part from 43 to 62 (to 63 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:15:34.032] 🐞 Відлагодження: parso.python.diff • -> code[delete] old[60:73] new[60:59]
[Refridex OS • DEBUG • 2025-09-18 00:15:34.033] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[74:79] new[60:65]
[Refridex OS • DEBUG • 2025-09-18 00:15:34.033] 🐞 Відлагодження: parso.python.diff • copy old[78:78] new[63:64]
[Refridex OS • DEBUG • 2025-09-18 00:15:34.033] 🐞 Відлагодження: parso.python.diff • parse_part from 65 to 64 (to 64 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:15:34.033] 🐞 Відлагодження: parso.python.diff • parse_part from 65 to 65 (to 64 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:15:34.034] 🐞 Відлагодження: parso.python.diff • diff parser end
[Refridex OS • DEBUG • 2025-09-18 00:15:47.050] 🐞 Відлагодження: parso.python.diff • diff parser start
[Refridex OS • DEBUG • 2025-09-18 00:15:47.050] 🐞 Відлагодження: parso.python.diff • line_lengths old: 56; new: 44
[Refridex OS • DEBUG • 2025-09-18 00:15:47.050] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[1:31] new[1:31]
[Refridex OS • DEBUG • 2025-09-18 00:15:47.051] 🐞 Відлагодження: parso.python.diff • copy old[4:30] new[1:30]
[Refridex OS • DEBUG • 2025-09-18 00:15:47.051] 🐞 Відлагодження: parso.python.diff • parse_part from 31 to 32 (to 32 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:15:47.051] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[32:32] new[32:33]
[Refridex OS • DEBUG • 2025-09-18 00:15:47.053] 🐞 Відлагодження: parso.python.diff • parse_part from 33 to 43 (to 43 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:15:47.053] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[33:33] new[34:34]
[Refridex OS • DEBUG • 2025-09-18 00:15:47.053] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[34:34] new[35:38]
[Refridex OS • DEBUG • 2025-09-18 00:15:47.053] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[35:35] new[39:39]
[Refridex OS • DEBUG • 2025-09-18 00:15:47.053] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[36:55] new[40:43]
[Refridex OS • DEBUG • 2025-09-18 00:15:47.053] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[56:56] new[44:44]
[Refridex OS • DEBUG • 2025-09-18 00:15:47.054] 🐞 Відлагодження: parso.python.diff • parse_part from 44 to 44 (to 43 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:15:47.054] 🐞 Відлагодження: parso.python.diff • diff parser end
[Refridex OS • DEBUG • 2025-09-18 00:17:28.468] 🐞 Відлагодження: parso.python.diff • diff parser start
[Refridex OS • DEBUG • 2025-09-18 00:17:28.470] 🐞 Відлагодження: parso.python.diff • line_lengths old: 182; new: 146
[Refridex OS • DEBUG • 2025-09-18 00:17:28.470] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[1:12] new[1:12]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.471] 🐞 Відлагодження: parso.python.diff • copy old[4:12] new[1:12]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.471] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[13:13] new[13:13]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.472] 🐞 Відлагодження: parso.python.diff • parse_part from 13 to 13 (to 13 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:17:28.472] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[14:14] new[14:14]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.472] 🐞 Відлагодження: parso.python.diff • copy old[14:14] new[14:14]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.472] 🐞 Відлагодження: parso.python.diff • -> code[insert] old[15:14] new[15:15]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.472] 🐞 Відлагодження: parso.python.diff • parse_part from 15 to 15 (to 16 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:17:28.472] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[15:18] new[16:19]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.472] 🐞 Відлагодження: parso.python.diff • copy old[16:17] new[16:18]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.473] 🐞 Відлагодження: parso.python.diff • parse_part from 19 to 20 (to 21 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:17:28.473] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[19:28] new[20:20]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.473] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[29:40] new[21:32]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.473] 🐞 Відлагодження: parso.python.diff • copy old[30:64] new[21:31]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.474] 🐞 Відлагодження: parso.python.diff • parse_part from 32 to 37 (to 38 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:17:28.474] 🐞 Відлагодження: parso.python.diff • -> code[insert] old[41:40] new[33:33]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.474] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[41:41] new[34:34]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.474] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[42:42] new[35:35]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.474] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[43:78] new[36:71]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.474] 🐞 Відлагодження: parso.python.diff • copy old[46:52] new[38:45]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.475] 🐞 Відлагодження: parso.python.diff • parse_part from 46 to 58 (to 58 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:17:28.477] 🐞 Відлагодження: parso.python.diff • parse_part from 59 to 79 (to 80 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:17:28.478] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[79:86] new[72:79]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.478] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[87:88] new[80:81]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • parse_part from 80 to 102 (to 104 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[89:89] new[82:82]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[90:90] new[83:83]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[91:91] new[84:85]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[92:92] new[86:86]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[93:95] new[87:87]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[96:96] new[88:88]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[97:97] new[89:90]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[98:101] new[91:94]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[102:105] new[95:97]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[106:106] new[98:98]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[107:107] new[99:99]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[108:109] new[100:101]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.481] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[110:116] new[102:102]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.482] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[117:117] new[103:103]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • parse_part from 103 to 145 (to 145 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[insert] old[118:117] new[104:104]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[118:120] new[105:107]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[121:121] new[108:109]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[122:122] new[110:110]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[123:125] new[111:121]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[126:126] new[122:122]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[127:127] new[123:124]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[128:128] new[125:125]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[insert] old[129:128] new[126:126]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[129:129] new[127:127]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[delete] old[130:130] new[128:127]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[131:131] new[128:128]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[132:148] new[129:138]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[149:150] new[139:140]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.486] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[151:153] new[141:143]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.487] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[154:154] new[144:144]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.487] 🐞 Відлагодження: parso.python.diff • -> code[delete] old[155:180] new[145:144]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.487] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[181:182] new[145:146]
[Refridex OS • DEBUG • 2025-09-18 00:17:28.487] 🐞 Відлагодження: parso.python.diff • parse_part from 146 to 146 (to 145 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:17:28.487] 🐞 Відлагодження: parso.python.diff • diff parser end
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.376] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.377] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 00:18:05.377] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.378] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.378] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.399] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.400] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.400] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.401] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.401] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.401] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.401] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.401] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.401] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.401] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.401] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.401] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.401] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.401] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.402] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • КРИТИЧНО • 2025-09-18 00:18:05.404] 💥 КРИТИЧНА ПОМИЛКА: __main__ • Критична помилка в основному циклі: cannot import name 'get_models_inline_keyboard' from 'keyboards.inline_keyboard' (/home/kondiki/Refridex/keyboards/inline_keyboard.py)
Traceback (most recent call last):
  File "/home/kondiki/Refridex/main.py", line 203, in <module>
    asyncio.run(main())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/main.py", line 174, in main
    from handlers.catalog_handler import router as catalog_router
  File "/usr/lib/python3/dist-packages/thonny/plugins/cpython_backend/cp_back.py", line 263, in _custom_import
    module = self._original_import(*args, **kw)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 13, in <module>
    from keyboards.inline_keyboard import get_brands_inline_keyboard, get_models_inline_keyboard, get_back_to_models_keyboard # <--- ДОДАНО НОВУ ФУНКЦІЮ
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ImportError: cannot import name 'get_models_inline_keyboard' from 'keyboards.inline_keyboard' (/home/kondiki/Refridex/keyboards/inline_keyboard.py). Did you mean: 'get_users_list_keyboard'?
[Refridex OS • LOGCORE • 2025-09-18 00:18:05.410] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • DEBUG • 2025-09-18 00:31:22.701] 🐞 Відлагодження: parso.python.diff • diff parser start
[Refridex OS • DEBUG • 2025-09-18 00:31:22.701] 🐞 Відлагодження: parso.python.diff • line_lengths old: 44; new: 71
[Refridex OS • DEBUG • 2025-09-18 00:31:22.702] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[1:32] new[1:32]
[Refridex OS • DEBUG • 2025-09-18 00:31:22.702] 🐞 Відлагодження: parso.python.diff • copy old[4:30] new[1:30]
[Refridex OS • DEBUG • 2025-09-18 00:31:22.703] 🐞 Відлагодження: parso.python.diff • parse_part from 31 to 32 (to 32 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:31:22.703] 🐞 Відлагодження: parso.python.diff • -> code[insert] old[33:32] new[33:59]
[Refridex OS • DEBUG • 2025-09-18 00:31:22.708] 🐞 Відлагодження: parso.python.diff • parse_part from 33 to 70 (to 70 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:31:22.708] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[33:44] new[60:71]
[Refridex OS • DEBUG • 2025-09-18 00:31:22.708] 🐞 Відлагодження: parso.python.diff • parse_part from 71 to 71 (to 70 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:31:22.709] 🐞 Відлагодження: parso.python.diff • diff parser end
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.069] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.070] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 00:31:29.070] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.070] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.070] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.093] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.094] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.094] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.094] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.094] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.094] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.095] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.095] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.095] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.095] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.095] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.095] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.095] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.095] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.095] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.099] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.100] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.100] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.100] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.100] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.100] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.296] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.296] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.296] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.297] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.297] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.298] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.298] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.298] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.299] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 00:31:29.299] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.995] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.996] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.996] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.996] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 00:31:29.997] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 00:31:36.631] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:31:36.631] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:31:36.631] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:31:36.631] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:31:36.631] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:31:36.631] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 00:31:36.634] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:31:36.635] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:31:36.885] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:31:36.886] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 00:31:36.889] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 00:31:36.984] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 00:31:38.535] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:31:38.536] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:31:38.536] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:31:38.536] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:31:38.536] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:31:38.538] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 00:31:38.749] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 00:31:41.404] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:31:41.404] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:31:41.404] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:31:41.404] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:31:41.404] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:31:41.405] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 00:31:42.845] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:31:42.846] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:31:42.846] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:31:42.846] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:31:42.846] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:31:42.847] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • ПОМИЛКА • 2025-09-18 00:31:42.906] ❌ Помилка: middlewares.exception_middleware • Виникла глобальна помилка під час обробки оновлення 88513494: 0
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 130, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data[0])
                                                           ~~~~~~~~~~^^^
KeyError: 0
[Refridex OS • КРИТИЧНО • 2025-09-18 00:31:42.907] 💥 КРИТИЧНА ПОМИЛКА: middlewares.exception_middleware • Критична неперехоплена помилка: 0
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 130, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data[0])
                                                           ~~~~~~~~~~^^^
KeyError: 0
[Refridex OS • УВАГА • 2025-09-18 00:33:06.787] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 00:33:06.788] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:33:06.788] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:33:06.788] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:33:06.788] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:33:06.789] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:33:06.789] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:33:06.789] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:33:06.790] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:33:06.791] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:33:06.791] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 00:33:07.042] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:33:07.043] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 00:33:07.045] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.243] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.244] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 00:33:10.244] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.245] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.245] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.268] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.269] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.270] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.270] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.270] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.270] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.270] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.270] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.270] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.270] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.270] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.271] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.271] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.271] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.271] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.275] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.275] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.275] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.275] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.276] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.276] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.491] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.491] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.491] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.492] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.492] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.493] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.493] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.493] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 00:33:10.494] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 00:33:10.494] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 00:33:11.027] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 00:33:11.027] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:33:11.027] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:33:11.027] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 00:33:11.027] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 00:33:13.031] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:33:13.031] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:33:13.031] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:33:13.031] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:33:13.031] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:33:13.031] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) повернувся в головне меню.
[Refridex OS • ПОМИЛКА • 2025-09-18 00:33:13.269] ❌ Помилка: middlewares.exception_middleware • Виникла глобальна помилка під час обробки оновлення 88513495: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 74, in back_to_main_menu_handler
    await callback_query.message.answer(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/types/message.py", line 2074, in answer
    return SendMessage(
           ^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/pydantic/main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
[Refridex OS • КРИТИЧНО • 2025-09-18 00:33:13.271] 💥 КРИТИЧНА ПОМИЛКА: middlewares.exception_middleware • Критична неперехоплена помилка: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 74, in back_to_main_menu_handler
    await callback_query.message.answer(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/types/message.py", line 2074, in answer
    return SendMessage(
           ^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/pydantic/main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<coroutine object get_mai...board at 0x72fe5299d940>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
[Refridex OS • DEBUG • 2025-09-18 00:33:15.207] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:33:15.208] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:33:15.208] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:33:15.208] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:33:15.208] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:33:15.208] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 00:33:15.210] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:33:15.212] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:33:15.305] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:33:15.305] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 00:33:15.306] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 00:33:15.403] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 00:33:20.192] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:33:20.192] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:33:20.192] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:33:20.192] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:33:20.192] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:33:20.193] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 00:33:20.362] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 00:33:22.028] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:33:22.028] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:33:22.028] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:33:22.028] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:33:22.028] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:33:22.029] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 00:33:23.244] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:33:23.245] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:33:23.245] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:33:23.245] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:33:23.245] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:33:23.245] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • ПОМИЛКА • 2025-09-18 00:33:23.296] ❌ Помилка: middlewares.exception_middleware • Виникла глобальна помилка під час обробки оновлення 88513499: 0
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 132, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data[0])
                                                           ~~~~~~~~~~^^^
KeyError: 0
[Refridex OS • КРИТИЧНО • 2025-09-18 00:33:23.297] 💥 КРИТИЧНА ПОМИЛКА: middlewares.exception_middleware • Критична неперехоплена помилка: 0
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 132, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data[0])
                                                           ~~~~~~~~~~^^^
KeyError: 0
[Refridex OS • УВАГА • 2025-09-18 00:34:34.396] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 00:34:34.397] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:34:34.398] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:34:34.398] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:34:34.399] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:34:34.399] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:34:34.399] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:34:34.399] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:34:34.403] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:34:34.403] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:34:34.403] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 00:34:34.655] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:34:34.655] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 00:34:34.656] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.839] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.839] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 00:34:37.840] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.840] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.840] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.862] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.863] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.863] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.863] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.864] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.864] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.864] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.864] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.864] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.864] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.864] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.864] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.864] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.864] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.865] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.868] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.869] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.869] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.869] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.869] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:34:37.870] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.077] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.078] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.078] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.079] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.079] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.080] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.080] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.080] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.080] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 00:34:38.080] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.612] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.612] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.612] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.612] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 00:34:38.613] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 00:34:39.085] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:34:39.085] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:34:39.085] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:34:39.085] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:34:39.085] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:34:39.086] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 00:34:39.088] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:34:39.089] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:34:39.432] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:34:39.432] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 00:34:39.433] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 00:34:39.638] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 00:34:41.416] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:34:41.416] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:34:41.416] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:34:41.416] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:34:41.416] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:34:41.417] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 00:34:41.589] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 00:34:43.418] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:34:43.418] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:34:43.418] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:34:43.419] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:34:43.419] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:34:43.419] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 00:34:45.976] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:34:45.976] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:34:45.977] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:34:45.977] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:34:45.977] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:34:45.977] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • ПОМИЛКА • 2025-09-18 00:34:46.053] ❌ Помилка: middlewares.exception_middleware • Виникла глобальна помилка під час обробки оновлення 88513503: 0
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 132, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data[0])
                                                           ~~~~~~~~~~^^^
KeyError: 0
[Refridex OS • КРИТИЧНО • 2025-09-18 00:34:46.055] 💥 КРИТИЧНА ПОМИЛКА: middlewares.exception_middleware • Критична неперехоплена помилка: 0
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 132, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data[0])
                                                           ~~~~~~~~~~^^^
KeyError: 0
[Refridex OS • УВАГА • 2025-09-18 00:36:24.697] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 00:36:24.698] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:36:24.699] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:36:24.699] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:36:24.700] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:36:24.701] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:36:24.701] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:36:24.701] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:36:24.708] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:36:24.709] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:36:24.709] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 00:36:24.960] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:36:24.961] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 00:36:24.961] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.250] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.251] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 00:36:28.251] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.251] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.251] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.274] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.275] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.275] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.275] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.275] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.276] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.276] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.276] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.276] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.276] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.276] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.276] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.276] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.276] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.276] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.280] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.281] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.281] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.281] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.281] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.281] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.498] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.499] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.499] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.500] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.500] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.501] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.501] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.501] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 00:36:28.501] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 00:36:28.501] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 00:36:29.002] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 00:36:29.002] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:36:29.002] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:36:29.002] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 00:36:29.002] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 00:36:29.369] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:36:29.369] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:36:29.369] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:36:29.369] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:36:29.369] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:36:29.369] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 00:36:29.372] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:36:29.373] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:36:29.605] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:36:29.605] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 00:36:29.607] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 00:36:29.695] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 00:36:31.194] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:36:31.195] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:36:31.195] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:36:31.195] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:36:31.195] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:36:31.197] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 00:36:31.393] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 00:36:32.614] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:36:32.614] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:36:32.614] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:36:32.614] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:36:32.615] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:36:32.615] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 00:36:33.789] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:36:33.790] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:36:33.790] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:36:33.790] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:36:33.790] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:36:33.790] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • ПОМИЛКА • 2025-09-18 00:36:33.841] ❌ Помилка: middlewares.exception_middleware • Виникла глобальна помилка під час обробки оновлення 88513507: 0
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 133, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data[0])
                                                           ~~~~~~~~~~^^^
KeyError: 0
[Refridex OS • КРИТИЧНО • 2025-09-18 00:36:33.843] 💥 КРИТИЧНА ПОМИЛКА: middlewares.exception_middleware • Критична неперехоплена помилка: 0
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 133, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data[0])
                                                           ~~~~~~~~~~^^^
KeyError: 0
[Refridex OS • УВАГА • 2025-09-18 00:43:01.442] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 00:43:01.444] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:43:01.444] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:43:01.444] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:43:01.445] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:43:01.446] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:43:01.446] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:43:01.446] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:43:01.447] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:43:01.447] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:43:01.447] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 00:43:01.698] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:43:01.699] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 00:43:01.700] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 00:43:04.987] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 00:43:04.988] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 00:43:04.988] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 00:43:04.989] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 00:43:04.989] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.015] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.016] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.016] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.017] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.017] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.017] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.017] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.017] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.017] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.017] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.017] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.018] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.018] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.018] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.018] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.022] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.022] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.023] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.023] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.023] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.023] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.243] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.243] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.243] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.244] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.244] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.245] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.245] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.245] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.245] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 00:43:05.245] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.861] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.862] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.862] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.862] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 00:43:05.862] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 00:43:07.001] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:43:07.001] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:43:07.001] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:43:07.001] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:43:07.002] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:43:07.002] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 00:43:07.004] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:43:07.005] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:43:07.241] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:43:07.242] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 00:43:07.243] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 00:43:07.325] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 00:43:09.586] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:43:09.586] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:43:09.586] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:43:09.586] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:43:09.586] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:43:09.589] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 00:43:09.770] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 00:43:11.583] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:43:11.584] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:43:11.584] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:43:11.584] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:43:11.584] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:43:11.585] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 00:43:12.989] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:43:12.989] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:43:12.989] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:43:12.989] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:43:12.989] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:43:12.990] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • ПОМИЛКА • 2025-09-18 00:43:13.039] ❌ Помилка: middlewares.exception_middleware • Виникла глобальна помилка під час обробки оновлення 88513511: 0
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 133, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data[0])
                                                           ~~~~~~~~~~^^^
KeyError: 0
[Refridex OS • КРИТИЧНО • 2025-09-18 00:43:13.041] 💥 КРИТИЧНА ПОМИЛКА: middlewares.exception_middleware • Критична неперехоплена помилка: 0
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 133, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data[0])
                                                           ~~~~~~~~~~^^^
KeyError: 0
[Refridex OS • УВАГА • 2025-09-18 00:44:28.541] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 00:44:28.542] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:44:28.542] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:44:28.543] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:44:28.543] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:44:28.544] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:44:28.544] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:44:28.544] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:44:28.550] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:44:28.550] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:44:28.551] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 00:44:28.802] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:44:28.802] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 00:44:28.803] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.090] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.091] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 00:44:32.092] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.092] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.092] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.117] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.118] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.118] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.118] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.118] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.118] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.118] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.118] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.118] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.119] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.119] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.119] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.119] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.119] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.119] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • КРИТИЧНО • 2025-09-18 00:44:32.122] 💥 КРИТИЧНА ПОМИЛКА: __main__ • Критична помилка в основному циклі: No module named 'utils.message_formatter'
Traceback (most recent call last):
  File "/home/kondiki/Refridex/main.py", line 203, in <module>
    asyncio.run(main())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/main.py", line 174, in main
    from handlers.catalog_handler import router as catalog_router
  File "/usr/lib/python3/dist-packages/thonny/plugins/cpython_backend/cp_back.py", line 263, in _custom_import
    module = self._original_import(*args, **kw)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 16, in <module>
    from utils.message_formatter import format_model_details_message
  File "/usr/lib/python3/dist-packages/thonny/plugins/cpython_backend/cp_back.py", line 263, in _custom_import
    module = self._original_import(*args, **kw)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ModuleNotFoundError: No module named 'utils.message_formatter'
[Refridex OS • LOGCORE • 2025-09-18 00:44:32.124] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • DEBUG • 2025-09-18 00:46:18.134] 🐞 Відлагодження: parso.python.diff • diff parser start
[Refridex OS • DEBUG • 2025-09-18 00:46:18.136] 🐞 Відлагодження: parso.python.diff • line_lengths old: 143; new: 140
[Refridex OS • DEBUG • 2025-09-18 00:46:18.136] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[1:15] new[1:15]
[Refridex OS • DEBUG • 2025-09-18 00:46:18.136] 🐞 Відлагодження: parso.python.diff • copy old[4:15] new[1:15]
[Refridex OS • DEBUG • 2025-09-18 00:46:18.137] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[16:16] new[16:16]
[Refridex OS • DEBUG • 2025-09-18 00:46:18.137] 🐞 Відлагодження: parso.python.diff • parse_part from 16 to 16 (to 17 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:46:18.137] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[17:92] new[17:92]
[Refridex OS • DEBUG • 2025-09-18 00:46:18.138] 🐞 Відлагодження: parso.python.diff • copy old[18:120] new[17:91]
[Refridex OS • DEBUG • 2025-09-18 00:46:18.138] 🐞 Відлагодження: parso.python.diff • parse_part from 92 to 93 (to 94 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:46:18.138] 🐞 Відлагодження: parso.python.diff • -> code[delete] old[93:93] new[93:92]
[Refridex OS • DEBUG • 2025-09-18 00:46:18.139] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[94:101] new[93:100]
[Refridex OS • DEBUG • 2025-09-18 00:46:18.144] 🐞 Відлагодження: parso.python.diff • parse_part from 94 to 118 (to 118 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:46:18.144] 🐞 Відлагодження: parso.python.diff • -> code[delete] old[102:102] new[101:100]
[Refridex OS • DEBUG • 2025-09-18 00:46:18.144] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[103:104] new[101:102]
[Refridex OS • DEBUG • 2025-09-18 00:46:18.144] 🐞 Відлагодження: parso.python.diff • -> code[delete] old[105:105] new[103:102]
[Refridex OS • DEBUG • 2025-09-18 00:46:18.144] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[106:143] new[103:140]
[Refridex OS • DEBUG • 2025-09-18 00:46:18.147] 🐞 Відлагодження: parso.python.diff • parse_part from 119 to 139 (to 139 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:46:18.147] 🐞 Відлагодження: parso.python.diff • parse_part from 140 to 140 (to 139 in part parser)
[Refridex OS • DEBUG • 2025-09-18 00:46:18.147] 🐞 Відлагодження: parso.python.diff • diff parser end
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.605] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.606] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 00:46:24.607] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.607] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.607] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.633] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.634] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.634] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.635] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.635] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.635] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.635] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.635] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.635] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.635] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.635] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.635] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.636] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.636] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.636] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.640] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.640] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.640] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.640] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.641] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.641] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.850] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.850] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.850] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.851] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.851] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.852] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.852] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.852] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 00:46:24.853] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 00:46:24.853] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 00:46:25.345] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 00:46:25.345] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:46:25.345] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:46:25.345] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 00:46:25.346] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 00:46:25.682] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:46:25.682] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:46:25.682] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:46:25.682] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:46:25.682] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:46:25.683] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 00:46:25.685] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:46:25.686] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:46:26.022] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:46:26.022] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 00:46:26.025] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 00:46:26.132] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 00:46:29.057] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:46:29.058] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:46:29.058] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:46:29.058] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:46:29.058] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:46:29.059] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 00:46:29.300] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 00:46:31.062] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:46:31.063] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:46:31.063] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:46:31.063] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:46:31.063] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:46:31.064] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 00:46:32.460] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:46:32.460] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:46:32.460] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:46:32.460] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:46:32.460] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:46:32.461] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • УВАГА • 2025-09-18 00:49:44.718] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 00:49:44.719] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:49:44.720] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:49:44.720] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:49:44.721] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:49:44.721] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:49:44.721] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:49:44.722] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:49:44.730] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:49:44.731] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:49:44.731] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 00:49:44.983] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:49:44.984] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 00:49:44.986] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.099] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.100] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 00:49:48.100] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.100] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.100] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.123] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.124] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.125] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.125] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.125] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.125] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.125] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.125] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.125] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.125] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.125] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.125] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.126] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.126] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.126] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.130] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.130] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.130] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.130] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.130] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.131] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.330] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.330] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.330] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.331] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.332] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.332] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.333] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.333] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.333] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 00:49:48.333] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.840] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.840] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.840] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.840] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 00:49:48.840] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 00:49:49.883] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:49:49.883] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:49:49.883] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:49:49.883] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:49:49.883] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:49:49.884] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 00:49:53.099] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:49:53.099] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:49:53.099] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:49:53.099] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:49:53.099] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:49:53.100] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 00:49:53.102] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:49:53.102] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:49:53.218] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:49:53.218] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 00:49:53.220] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 00:49:53.302] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 00:49:54.896] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:49:54.896] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:49:54.896] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:49:54.896] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:49:54.896] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:49:54.897] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 00:49:55.072] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 00:49:56.376] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:49:56.376] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:49:56.376] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:49:56.376] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:49:56.377] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:49:56.377] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 00:49:57.614] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:49:57.614] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:49:57.614] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:49:57.615] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:49:57.615] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:49:57.615] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • УВАГА • 2025-09-18 00:52:17.578] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 00:52:17.578] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:52:17.579] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:52:17.579] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:52:17.580] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:52:17.580] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:52:17.580] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:52:17.580] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:52:17.586] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:52:17.586] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:52:17.586] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 00:52:17.837] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:52:17.838] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 00:52:17.841] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 00:52:20.992] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 00:52:20.992] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 00:52:20.993] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 00:52:20.993] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 00:52:20.993] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.016] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.016] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.017] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.017] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.017] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.017] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.017] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.017] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.017] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.017] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.017] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.017] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.018] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.018] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.018] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.022] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.022] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.022] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.022] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.023] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.023] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.239] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.240] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.240] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.241] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.241] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.242] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.242] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.242] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.242] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 00:52:21.242] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.930] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.930] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.930] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.930] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 00:52:21.930] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 00:52:22.563] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:52:22.564] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:52:22.564] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:52:22.564] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:52:22.564] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:52:22.564] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 00:52:22.571] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:52:22.571] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:52:22.802] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:52:22.803] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 00:52:22.804] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 00:52:22.898] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 00:52:24.400] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:52:24.400] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:52:24.401] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:52:24.401] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:52:24.401] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:52:24.402] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 00:52:24.568] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 00:52:26.210] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:52:26.210] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:52:26.210] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:52:26.210] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:52:26.210] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:52:26.210] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 00:52:27.196] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:52:27.196] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:52:27.196] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:52:27.197] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:52:27.197] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:52:27.197] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • УВАГА • 2025-09-18 00:54:23.685] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 00:54:23.686] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:54:23.687] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:54:23.687] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:54:23.688] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:54:23.688] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:54:23.688] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:54:23.689] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:54:23.694] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:54:23.694] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:54:23.695] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 00:54:23.946] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:54:23.947] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 00:54:23.949] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.113] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.114] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 00:54:27.114] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.114] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.114] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.138] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.139] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.139] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.140] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.140] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.140] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.140] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.140] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.140] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.140] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.140] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.140] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.140] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.141] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.141] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.145] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.145] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.145] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.145] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.146] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.146] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.352] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.352] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.352] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.353] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.354] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.354] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.355] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.355] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.355] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 00:54:27.355] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.863] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.863] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.863] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.863] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 00:54:27.863] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 00:54:29.612] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:54:29.613] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:54:29.613] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:54:29.613] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:54:29.613] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:54:29.613] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 00:54:29.617] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:54:29.618] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:54:29.848] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:54:29.848] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 00:54:29.849] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 00:54:29.939] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 00:54:31.660] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:54:31.661] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:54:31.661] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:54:31.661] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:54:31.661] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:54:31.662] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 00:54:31.852] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 00:54:33.379] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:54:33.379] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:54:33.379] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:54:33.379] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:54:33.379] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:54:33.380] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 00:54:34.498] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:54:34.498] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:54:34.498] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:54:34.498] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:54:34.498] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:54:34.499] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • ПОМИЛКА • 2025-09-18 00:54:34.559] ❌ Помилка: middlewares.exception_middleware • Виникла глобальна помилка під час обробки оновлення 88513528: 'TypeSeries'
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 104, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/services/message_formatter.py", line 28, in format_model_details_message
    formatted_basic_info = basic_info_template.format(**data_for_format)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyError: 'TypeSeries'
[Refridex OS • КРИТИЧНО • 2025-09-18 00:54:34.560] 💥 КРИТИЧНА ПОМИЛКА: middlewares.exception_middleware • Критична неперехоплена помилка: 'TypeSeries'
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 104, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/services/message_formatter.py", line 28, in format_model_details_message
    formatted_basic_info = basic_info_template.format(**data_for_format)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyError: 'TypeSeries'
[Refridex OS • DEBUG • 2025-09-18 00:58:10.223] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:58:10.223] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:58:10.223] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:58:10.223] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:58:10.223] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:10.223] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 00:58:10.225] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:58:10.225] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:58:10.330] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:58:10.330] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 00:58:10.331] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 00:58:10.424] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 00:58:12.087] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:58:12.087] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:58:12.087] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:58:12.087] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:58:12.087] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:12.088] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:12.260] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 00:58:13.559] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:58:13.559] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:58:13.559] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:58:13.559] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:58:13.559] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:13.560] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 00:58:14.743] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:58:14.744] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:58:14.744] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:58:14.744] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:58:14.744] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:14.744] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • DEBUG • 2025-09-18 00:58:22.153] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:58:22.153] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:58:22.153] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:58:22.153] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:58:22.153] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:22.153] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 00:58:22.155] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:58:22.155] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:58:22.338] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:58:22.338] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 00:58:22.339] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 00:58:22.481] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 00:58:23.715] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:58:23.716] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:58:23.716] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:58:23.716] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:58:23.716] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:23.717] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:24.183] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 00:58:25.611] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:58:25.612] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:58:25.612] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:58:25.612] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:58:25.612] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:25.612] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 00:58:28.337] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:58:28.337] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:58:28.338] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:58:28.338] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:58:28.338] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:28.338] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • УВАГА • 2025-09-18 00:58:56.295] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 00:58:56.296] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:58:56.296] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:58:56.296] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:58:56.297] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:58:56.297] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:58:56.297] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 00:58:56.297] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:58:56.299] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:58:56.299] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:58:56.299] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 00:58:56.551] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 00:58:56.552] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 00:58:56.553] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.816] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.817] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 00:58:59.817] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.817] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.817] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.840] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.841] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.841] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.841] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.842] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.842] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.842] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.842] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.842] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.842] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.842] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.842] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.842] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.842] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.843] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.846] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.847] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.847] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.847] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.847] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 00:58:59.848] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.072] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.073] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.073] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.074] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.074] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.074] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.075] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.075] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.075] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 00:59:00.075] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.664] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.664] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.664] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.664] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 00:59:00.664] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 00:59:01.037] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:59:01.037] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:59:01.037] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:59:01.037] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:59:01.037] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:59:01.037] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 00:59:01.040] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:59:01.041] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:59:01.270] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 00:59:01.270] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 00:59:01.271] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 00:59:01.355] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 00:59:02.950] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:59:02.950] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:59:02.950] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:59:02.950] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:59:02.950] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:59:02.951] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 00:59:03.140] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 00:59:04.368] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:59:04.368] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:59:04.368] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:59:04.368] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:59:04.368] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:59:04.368] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 00:59:06.871] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 00:59:06.872] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 00:59:06.872] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 00:59:06.872] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 00:59:06.872] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 00:59:06.872] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • DEBUG • 2025-09-18 01:03:08.052] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:03:08.052] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:03:08.052] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:03:08.052] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:03:08.052] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:03:08.052] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:03:08.054] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:03:08.055] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:03:08.233] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:03:08.234] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:03:08.236] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:03:08.369] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 01:03:10.344] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:03:10.344] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:03:10.344] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:03:10.344] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:03:10.344] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:03:10.345] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:03:10.534] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:03:11.612] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:03:11.612] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:03:11.612] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:03:11.612] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:03:11.612] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:03:11.612] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:03:12.521] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:03:12.521] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:03:12.521] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:03:12.521] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:03:12.521] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:03:12.522] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • DEBUG • 2025-09-18 01:05:04.777] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:05:04.777] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:05:04.777] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:05:04.778] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:05:04.778] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:05:04.778] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:05:04.781] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:05:04.781] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:05:04.889] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:05:04.889] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:05:04.890] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:05:04.980] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 01:05:06.418] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:05:06.418] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:05:06.418] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:05:06.418] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:05:06.418] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:05:06.420] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:05:06.605] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:05:07.815] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:05:07.815] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:05:07.815] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:05:07.815] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:05:07.815] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:05:07.815] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:05:09.866] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:05:09.866] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:05:09.867] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:05:09.867] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:05:09.867] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:05:09.867] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • DEBUG • 2025-09-18 01:07:09.340] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:07:09.340] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:07:09.340] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:07:09.340] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:07:09.340] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:07:09.340] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:07:09.342] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:07:09.343] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:07:09.437] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:07:09.437] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:07:09.438] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:07:09.526] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 01:07:11.183] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:07:11.183] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:07:11.183] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:07:11.183] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:07:11.183] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:07:11.185] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:07:11.337] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:07:12.927] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:07:12.927] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:07:12.927] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:07:12.927] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:07:12.927] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:07:12.928] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:07:13.893] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:07:13.893] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:07:13.893] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:07:13.893] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:07:13.893] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:07:13.894] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • DEBUG • 2025-09-18 01:07:35.592] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:07:35.592] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:07:35.592] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:07:35.592] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:07:35.592] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:07:35.593] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:07:35.595] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:07:35.595] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:07:35.685] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:07:35.685] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:07:35.686] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:07:38.127] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 01:07:40.209] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:07:40.210] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:07:40.210] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:07:40.210] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:07:40.210] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:07:40.210] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:07:40.371] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:07:41.880] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:07:41.880] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:07:41.880] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:07:41.880] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:07:41.880] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:07:41.880] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:07:43.075] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:07:43.075] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:07:43.075] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:07:43.076] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:07:43.076] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:07:43.076] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • DEBUG • 2025-09-18 01:09:53.490] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:09:53.490] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:09:53.490] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:09:53.490] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:09:53.490] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:09:53.490] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:09:53.492] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:09:53.492] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:09:53.596] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:09:53.596] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:09:53.597] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:09:53.685] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 01:09:54.900] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:09:54.901] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:09:54.901] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:09:54.901] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:09:54.901] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:09:54.903] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:09:55.069] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:09:56.283] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:09:56.283] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:09:56.283] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:09:56.283] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:09:56.283] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:09:56.284] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:09:57.252] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:09:57.252] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:09:57.252] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:09:57.252] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:09:57.252] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:09:57.253] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • DEBUG • 2025-09-18 01:10:07.166] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:10:07.166] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:10:07.166] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:10:07.166] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:10:07.166] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:10:07.167] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:11:45.435] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:11:45.436] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:11:45.436] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:11:45.436] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:11:45.436] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:11:45.437] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • УВАГА • 2025-09-18 01:20:40.509] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 01:20:40.510] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:20:40.510] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:20:40.511] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:20:40.512] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:20:40.512] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:20:40.512] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:20:40.513] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:20:40.513] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:20:40.513] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:20:40.514] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 01:20:40.765] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:20:40.765] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 01:20:40.767] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.885] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.886] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 01:20:43.886] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.886] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.887] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.910] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.911] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.911] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.911] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.911] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.911] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.911] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.912] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.912] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.912] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.912] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.912] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.912] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.912] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.912] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • КРИТИЧНО • 2025-09-18 01:20:43.915] 💥 КРИТИЧНА ПОМИЛКА: __main__ • Критична помилка в основному циклі: cannot import name 'format_model_details_message' from 'services.message_formatter' (/home/kondiki/Refridex/services/message_formatter.py)
Traceback (most recent call last):
  File "/home/kondiki/Refridex/main.py", line 203, in <module>
    asyncio.run(main())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/main.py", line 174, in main
    from handlers.catalog_handler import router as catalog_router
  File "/usr/lib/python3/dist-packages/thonny/plugins/cpython_backend/cp_back.py", line 263, in _custom_import
    module = self._original_import(*args, **kw)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 16, in <module>
    from services.message_formatter import format_model_details_message
ImportError: cannot import name 'format_model_details_message' from 'services.message_formatter' (/home/kondiki/Refridex/services/message_formatter.py)
[Refridex OS • LOGCORE • 2025-09-18 01:20:43.917] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • DEBUG • 2025-09-18 01:22:27.641] 🐞 Відлагодження: parso.cache • pickle loaded: /home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/__init__.py
[Refridex OS • DEBUG • 2025-09-18 01:22:27.648] 🐞 Відлагодження: parso.cache • pickle loaded: /home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/enums/__init__.py
[Refridex OS • DEBUG • 2025-09-18 01:22:27.650] 🐞 Відлагодження: parso.cache • pickle loaded: /home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/enums/parse_mode.py
[Refridex OS • DEBUG • 2025-09-18 01:22:34.005] 🐞 Відлагодження: parso.python.diff • diff parser start
[Refridex OS • DEBUG • 2025-09-18 01:22:34.005] 🐞 Відлагодження: parso.python.diff • line_lengths old: 17; new: 17
[Refridex OS • DEBUG • 2025-09-18 01:22:34.006] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[1:1] new[1:1]
[Refridex OS • DEBUG • 2025-09-18 01:22:34.006] 🐞 Відлагодження: parso.python.diff • parse_part from 1 to 4 (to 5 in part parser)
[Refridex OS • DEBUG • 2025-09-18 01:22:34.007] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[2:2] new[2:2]
[Refridex OS • DEBUG • 2025-09-18 01:22:34.007] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[3:5] new[3:5]
[Refridex OS • DEBUG • 2025-09-18 01:22:34.010] 🐞 Відлагодження: parso.python.diff • parse_part from 5 to 16 (to 16 in part parser)
[Refridex OS • DEBUG • 2025-09-18 01:22:34.010] 🐞 Відлагодження: parso.python.diff • -> code[replace] old[6:6] new[6:6]
[Refridex OS • DEBUG • 2025-09-18 01:22:34.010] 🐞 Відлагодження: parso.python.diff • -> code[equal] old[7:17] new[7:17]
[Refridex OS • DEBUG • 2025-09-18 01:22:34.010] 🐞 Відлагодження: parso.python.diff • parse_part from 17 to 17 (to 16 in part parser)
[Refridex OS • DEBUG • 2025-09-18 01:22:34.011] 🐞 Відлагодження: parso.python.diff • diff parser end
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.767] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.768] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 01:22:39.768] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.769] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.769] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.794] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.795] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.795] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.795] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.795] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.795] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.796] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.796] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.796] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.796] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.796] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.796] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.796] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.796] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.796] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.800] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.801] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.801] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.801] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.801] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:22:39.801] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.023] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.023] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.023] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.024] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.024] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.025] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.025] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.025] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.025] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 01:22:40.025] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.584] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.584] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.584] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.584] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.584] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 01:22:40.880] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:22:40.880] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:22:40.880] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:22:40.881] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:22:40.881] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.881] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.887] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:22:40.888] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:22:41.128] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:22:41.128] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:22:41.132] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:22:41.219] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 01:22:42.436] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:22:42.436] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:22:42.436] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:22:42.436] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:22:42.436] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:22:42.437] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:22:42.600] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:22:43.600] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:22:43.600] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:22:43.600] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:22:43.600] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:22:43.600] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:22:43.600] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:22:44.363] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:22:44.364] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:22:44.364] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:22:44.364] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:22:44.364] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:22:44.364] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • ПОМИЛКА • 2025-09-18 01:22:44.413] ❌ Помилка: middlewares.exception_middleware • Виникла глобальна помилка під час обробки оновлення 88513566: format_model_details_message() missing 1 required positional argument: 'dimensions'
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 104, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: format_model_details_message() missing 1 required positional argument: 'dimensions'
[Refridex OS • КРИТИЧНО • 2025-09-18 01:22:44.414] 💥 КРИТИЧНА ПОМИЛКА: middlewares.exception_middleware • Критична неперехоплена помилка: format_model_details_message() missing 1 required positional argument: 'dimensions'
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 104, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: format_model_details_message() missing 1 required positional argument: 'dimensions'
[Refridex OS • УВАГА • 2025-09-18 01:24:40.623] ⚠️ Попередження: telethon.network.connection.connection • Server closed the connection: [Errno 104] Connection reset by peer
[Refridex OS • УВАГА • 2025-09-18 01:25:12.415] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 01:25:12.416] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:25:12.416] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:25:12.416] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:25:12.417] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:25:12.417] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:25:12.417] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:25:12.417] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:25:12.420] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:25:12.420] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:25:12.420] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 01:25:12.671] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:25:12.671] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 01:25:12.672] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.176] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.177] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 01:25:16.178] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.178] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.178] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.203] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.204] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.205] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.205] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.205] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.205] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.205] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.205] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.205] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.205] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.206] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.206] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.206] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.206] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.206] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.209] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.210] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.210] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.210] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.211] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.211] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.449] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.450] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.450] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.451] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.451] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.452] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.452] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.452] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.452] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 01:25:16.452] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.945] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.945] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.945] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.945] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 01:25:16.946] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 01:25:17.259] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:25:17.259] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:25:17.259] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:25:17.259] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:25:17.260] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:25:17.260] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:25:17.260] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:25:17.260] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:25:17.260] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:25:17.260] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:17.260] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:25:17.261] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) повернувся в головне меню.
[Refridex OS • LOGCORE • 2025-09-18 01:25:17.263] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:25:17.263] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:25:17.562] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:25:17.562] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:25:17.564] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:25:17.788] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • ПОМИЛКА • 2025-09-18 01:25:17.795] ❌ Помилка: middlewares.exception_middleware • Виникла глобальна помилка під час обробки оновлення 88513567: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 139, in back_to_main_menu_handler
    await callback_query.answer()
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/client/bot.py", line 478, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
[Refridex OS • КРИТИЧНО • 2025-09-18 01:25:17.797] 💥 КРИТИЧНА ПОМИЛКА: middlewares.exception_middleware • Критична неперехоплена помилка: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 139, in back_to_main_menu_handler
    await callback_query.answer()
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/client/bot.py", line 478, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
[Refridex OS • УВАГА • 2025-09-18 01:25:24.795] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 01:25:24.796] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:25:24.796] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:25:24.796] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:25:24.797] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:25:24.797] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:25:24.798] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:25:24.798] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:25:24.802] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:25:24.802] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:25:24.803] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 01:25:25.054] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:25:25.054] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 01:25:25.055] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.795] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.796] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 01:25:28.796] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.796] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.796] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.824] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.825] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.826] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.826] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.826] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.826] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.826] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.826] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.826] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.826] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.827] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.827] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.827] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.827] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.827] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.832] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.832] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.832] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.833] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.833] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:25:28.833] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.092] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.092] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.093] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.094] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.094] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.095] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.095] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.095] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.095] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 01:25:29.095] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.646] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.646] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.647] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.647] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.647] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 01:25:29.960] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:25:29.960] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:25:29.960] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:25:29.960] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:25:29.960] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.960] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.963] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:25:29.964] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:25:30.268] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:25:30.268] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:25:30.270] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:25:30.505] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 01:25:32.252] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:25:32.252] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:25:32.252] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:25:32.252] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:25:32.252] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:32.254] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:32.439] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:25:34.767] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:25:34.767] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:25:34.767] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:25:34.767] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:25:34.767] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:34.768] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) повернувся в головне меню.
[Refridex OS • DEBUG • 2025-09-18 01:25:37.503] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:25:37.503] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:25:37.503] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:25:37.503] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:25:37.503] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:37.504] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:37.669] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:25:39.364] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:25:39.364] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:25:39.364] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:25:39.364] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:25:39.364] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:39.365] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:25:43.266] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:25:43.266] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:25:43.266] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:25:43.266] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:25:43.266] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:43.267] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) повернувся в головне меню.
[Refridex OS • DEBUG • 2025-09-18 01:25:46.500] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:25:46.500] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:25:46.500] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:25:46.500] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:25:46.500] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:46.502] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:46.898] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:25:48.022] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:25:48.022] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:25:48.022] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:25:48.022] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:25:48.022] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:48.023] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:25:48.951] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:25:48.951] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:25:48.951] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:25:48.951] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:25:48.951] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:25:48.952] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • ПОМИЛКА • 2025-09-18 01:25:49.002] ❌ Помилка: middlewares.exception_middleware • Виникла глобальна помилка під час обробки оновлення 88513577: format_model_details_message() missing 1 required positional argument: 'dimensions'
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 104, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: format_model_details_message() missing 1 required positional argument: 'dimensions'
[Refridex OS • КРИТИЧНО • 2025-09-18 01:25:49.004] 💥 КРИТИЧНА ПОМИЛКА: middlewares.exception_middleware • Критична неперехоплена помилка: format_model_details_message() missing 1 required positional argument: 'dimensions'
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 104, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: format_model_details_message() missing 1 required positional argument: 'dimensions'
[Refridex OS • УВАГА • 2025-09-18 01:27:07.359] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 01:27:07.360] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:27:07.360] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:27:07.360] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:27:07.361] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:27:07.361] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:27:07.361] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:27:07.361] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:27:07.363] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:27:07.363] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:27:07.364] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 01:27:07.615] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:27:07.615] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 01:27:07.617] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.932] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.933] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 01:27:10.933] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.933] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.933] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.956] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.957] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.957] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.957] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.957] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.957] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.957] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.957] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.957] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.957] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.958] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.958] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.958] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.958] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.958] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.962] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.963] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.963] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.963] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.964] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:27:10.964] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.185] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.186] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.186] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.187] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.187] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.188] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.189] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.189] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.189] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 01:27:11.189] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.831] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.831] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.831] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.832] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 01:27:11.832] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 01:27:12.223] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:27:12.223] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:27:12.223] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:27:12.223] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:27:12.223] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:27:12.223] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:27:12.226] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:27:12.226] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:27:12.546] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:27:12.546] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:27:12.548] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:27:12.683] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 01:27:13.998] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:27:13.998] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:27:13.998] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:27:13.998] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:27:13.998] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:27:13.999] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:27:14.216] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:27:15.373] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:27:15.373] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:27:15.373] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:27:15.373] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:27:15.373] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:27:15.373] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:27:16.918] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:27:16.918] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:27:16.918] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:27:16.918] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:27:16.918] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:27:16.919] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • ПОМИЛКА • 2025-09-18 01:27:16.969] ❌ Помилка: middlewares.exception_middleware • Виникла глобальна помилка під час обробки оновлення 88513581: object str can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 104, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object str can't be used in 'await' expression
[Refridex OS • КРИТИЧНО • 2025-09-18 01:27:16.971] 💥 КРИТИЧНА ПОМИЛКА: middlewares.exception_middleware • Критична неперехоплена помилка: object str can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 104, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object str can't be used in 'await' expression
[Refridex OS • УВАГА • 2025-09-18 01:29:37.198] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 01:29:37.199] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:29:37.199] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:29:37.199] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:29:37.200] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:29:37.200] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:29:37.200] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:29:37.200] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:29:37.202] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:29:37.202] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:29:37.202] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 01:29:37.453] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:29:37.454] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 01:29:37.455] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.756] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.757] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 01:29:40.757] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.757] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.758] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.782] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.783] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.784] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.784] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.784] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.784] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.784] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.784] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.784] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.784] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.784] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.784] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.785] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.785] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.785] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.789] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.789] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.789] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.790] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.790] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:29:40.790] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.012] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.013] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.013] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.013] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.014] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.014] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.014] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.015] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.015] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 01:29:41.015] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.524] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.524] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.524] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.524] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 01:29:41.524] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 01:29:45.242] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:29:45.242] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:29:45.242] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:29:45.242] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:29:45.242] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:29:45.242] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:29:45.245] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:29:45.246] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:29:45.507] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:29:45.507] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:29:45.508] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:29:45.624] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 01:29:46.709] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:29:46.709] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:29:46.709] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:29:46.709] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:29:46.709] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:29:46.710] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:29:46.879] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:29:48.128] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:29:48.128] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:29:48.128] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:29:48.128] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:29:48.128] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:29:48.129] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:29:49.161] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:29:49.161] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:29:49.161] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:29:49.161] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:29:49.161] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:29:49.162] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • ПОМИЛКА • 2025-09-18 01:29:49.213] ❌ Помилка: middlewares.exception_middleware • Виникла глобальна помилка під час обробки оновлення 88513585: object str can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 104, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object str can't be used in 'await' expression
[Refridex OS • КРИТИЧНО • 2025-09-18 01:29:49.214] 💥 КРИТИЧНА ПОМИЛКА: middlewares.exception_middleware • Критична неперехоплена помилка: object str can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 104, in show_model_details_handler
    formatted_message = await format_model_details_message(model_data)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object str can't be used in 'await' expression
[Refridex OS • УВАГА • 2025-09-18 01:34:32.010] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 01:34:32.011] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:34:32.011] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:34:32.012] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:34:32.013] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:34:32.013] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:34:32.013] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:34:32.014] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:34:32.023] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:34:32.024] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:34:32.024] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 01:34:32.275] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:34:32.276] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 01:34:32.278] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.450] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.451] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 01:34:35.451] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.452] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.452] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.476] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.477] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.477] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.477] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.477] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.477] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.477] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.477] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.477] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.477] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.478] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.478] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.478] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.478] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.478] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.482] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.482] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.483] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.483] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.483] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.483] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.725] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.725] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.725] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.726] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.727] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.727] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.727] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.727] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 01:34:35.727] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 01:34:35.728] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 01:34:36.225] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 01:34:36.226] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:34:36.226] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:34:36.226] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 01:34:36.226] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 01:34:36.559] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:34:36.559] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:34:36.559] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:34:36.559] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:34:36.560] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:34:36.560] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:34:36.563] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:34:36.564] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:34:36.845] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:34:36.846] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:34:36.847] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:34:36.993] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 01:34:38.716] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:34:38.716] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:34:38.716] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:34:38.716] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:34:38.716] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:34:38.717] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:34:38.901] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:34:40.383] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:34:40.383] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:34:40.383] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:34:40.383] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:34:40.383] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:34:40.383] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:34:43.114] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:34:43.114] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:34:43.114] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:34:43.114] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:34:43.114] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:34:43.245] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • УВАГА • 2025-09-18 01:35:46.069] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 01:35:46.070] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:35:46.070] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:35:46.071] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:35:46.071] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:35:46.071] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:35:46.071] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:35:46.071] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:35:46.074] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:35:46.074] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:35:46.074] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 01:35:46.326] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:35:46.327] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 01:35:46.328] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.662] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.662] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 01:35:49.663] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.663] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.663] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.690] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.691] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.691] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.691] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.691] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.692] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.692] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.692] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.692] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.692] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.692] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.692] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.692] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.692] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.692] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.696] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.697] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.697] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.697] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.697] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.697] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.926] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.927] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.927] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.928] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.928] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.929] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.929] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.929] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 01:35:49.929] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 01:35:49.929] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 01:35:50.478] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 01:35:50.478] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:35:50.478] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:35:50.478] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 01:35:50.478] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 01:35:52.556] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:35:52.556] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:35:52.556] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:35:52.556] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:35:52.556] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:35:52.557] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:35:52.560] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:35:52.561] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:35:52.833] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:35:52.833] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:35:52.835] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:35:52.949] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 01:35:53.999] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:35:53.999] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:35:54.000] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:35:54.000] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:35:54.000] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:35:54.000] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:35:54.173] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:35:55.636] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:35:55.637] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:35:55.637] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:35:55.637] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:35:55.637] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:35:55.637] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:35:56.679] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:35:56.679] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:35:56.679] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:35:56.679] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:35:56.679] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:35:56.792] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • DEBUG • 2025-09-18 01:36:06.713] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:36:06.714] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:36:06.714] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:36:06.714] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:36:06.714] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:36:06.714] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:36:11.084] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:36:11.084] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:36:11.084] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:36:11.084] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:36:11.084] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:36:11.085] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) повернувся в головне меню.
[Refridex OS • ПОМИЛКА • 2025-09-18 01:36:11.174] ❌ Помилка: middlewares.exception_middleware • Виникла глобальна помилка під час обробки оновлення 88513595: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 75, in back_to_main_menu_handler
    await callback_query.message.answer(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/types/message.py", line 2074, in answer
    return SendMessage(
           ^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/pydantic/main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
[Refridex OS • КРИТИЧНО • 2025-09-18 01:36:11.176] 💥 КРИТИЧНА ПОМИЛКА: middlewares.exception_middleware • Критична неперехоплена помилка: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
Traceback (most recent call last):
  File "/home/kondiki/Refridex/middlewares/exception_middleware.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/handlers/catalog_handler.py", line 75, in back_to_main_menu_handler
    await callback_query.message.answer(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/aiogram/types/message.py", line 2074, in answer
    return SendMessage(
           ^^^^^^^^^^^^
  File "/home/kondiki/Refridex/venv/lib/python3.12/site-packages/pydantic/main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<coroutine object get_mai...board at 0x7ed66b955d00>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
[Refridex OS • DEBUG • 2025-09-18 01:38:26.952] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:38:26.952] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:38:26.952] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:38:26.952] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:38:26.952] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:38:26.953] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:38:27.002] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:38:27.002] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:38:27.125] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:38:27.126] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:38:27.127] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:38:27.249] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 01:38:29.161] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:38:29.162] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:38:29.162] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:38:29.162] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:38:29.162] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:38:29.163] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:38:29.325] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • УВАГА • 2025-09-18 01:39:22.907] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 01:39:22.908] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:39:22.908] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:39:22.908] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:39:22.909] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:39:22.910] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:39:22.910] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:39:22.910] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:39:22.918] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:39:22.919] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:39:22.920] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 01:39:23.171] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:39:23.172] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 01:39:23.173] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.263] 🔹 Стан: utils.logger • Логування налаштовано.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.264] 🔹 Стан: __main__ • Ядро ініціалізовано: активація блоку `if __name__ == '__main__'` розпочата...
[Refridex OS • DEBUG • 2025-09-18 01:39:26.264] 🐞 Відлагодження: asyncio • Using selector: EpollSelector
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.264] 🔹 Стан: __main__ • Початок виконання головної асинхронної функції 'main'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.264] 🔹 Стан: __main__ • Ініціалізація об'єкта Bot.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.288] 🔹 Стан: __main__ • Ініціалізація об'єкта Dispatcher.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.289] 🔹 Стан: __main__ • Реєстрація DbSessionMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.289] 🔹 Стан: middlewares.db_middleware • DbSessionMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.289] 🔹 Стан: __main__ • DbSessionMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.289] 🔹 Стан: __main__ • Ініціалізація глобального TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.289] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager ініціалізовано з API_ID: 20762337
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.290] 🔹 Стан: __main__ • TelethonClientManager додано до dispatcher.workflow_data.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.290] 🔹 Стан: __main__ • Реєстрація TelethonClientMiddleware.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.290] 🔹 Стан: middlewares.telethon_middleware • TelethonClientMiddleware ініціалізовано (без прямого передавання менеджера).
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.290] 🔹 Стан: __main__ • TelethonClientMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.290] 🔹 Стан: __main__ • Реєстрація ExceptionHandlingMiddleware (для централізованої обробки помилок).
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.290] 🔹 Стан: middlewares.exception_middleware • ExceptionHandlingMiddleware ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.290] 🔹 Стан: __main__ • ExceptionHandlingMiddleware зареєстровано глобально.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.290] 🔹 Стан: __main__ • Реєстрація роутера 'start_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.291] 🔹 Стан: __main__ • Реєстрація роутера 'menu_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.294] 🔹 Стан: __main__ • Реєстрація роутера 'catalog_handler'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.295] 🔹 Стан: __main__ • Реєстрація роутерів адмін-панелі.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.295] 🔹 Стан: __main__ • Реєстрація роутера 'echo_handler' (для невідомих кнопок та повідомлень).
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.295] 🔹 Стан: __main__ • Перед викликом dp.start_polling. Бот чекає на оновлення...
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.295] 🔹 Стан: __main__ • Початок запуску бота. Зареєстровані startup-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.295] 🔹 Стан: __main__ • Спроба створити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.518] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.518] 🔹 Стан: __main__ • Пул підключень до бази даних створено успішно.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.518] 🔹 Стан: __main__ • Ініціалізація таблиць бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.519] 🔹 Стан: database.db_pool_manager • Таблиця 'users' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.519] 🔹 Стан: database.db_pool_manager • Таблиця 'telethon_sessions' перевірена/створена.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.520] 🔹 Стан: __main__ • Таблиці бази даних ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.520] 🔹 Стан: __main__ • Ініціалізація TelethonClientManager.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.520] 🔹 Стан: telegram_client_module.telethon_client • TelethonClientManager отримав пул підключень до БД.
[Refridex OS • LOGCORE • 2025-09-18 01:39:26.521] 🔹 Стан: telegram_client_module.telethon_client • Завантаження всіх сесій Telethon з БД.
[Refridex OS • DEBUG • 2025-09-18 01:39:26.521] 🐞 Відлагодження: telegram_client_module.telethon_client • Отримання всіх сесій Telethon з БД для перевірки статусу.
[Refridex OS • LOGCORE • 2025-09-18 01:39:27.003] 🔹 Стан: telegram_client_module.telethon_client • Клієнт Telethon для 380997751324 (@Molfar2207) успішно завантажено та підключено.
[Refridex OS • LOGCORE • 2025-09-18 01:39:27.004] 🔹 Стан: telegram_client_module.telethon_client • Завантажено 1 активних Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:39:27.004] 🔹 Стан: __main__ • TelethonClientManager ініціалізовано.
[Refridex OS • LOGCORE • 2025-09-18 01:39:27.004] 🔹 Стан: __main__ • Telethon клієнти налаштовано та, якщо потрібно, запущені (через initialize()).
[Refridex OS • LOGCORE • 2025-09-18 01:39:27.004] 🔹 Стан: __main__ • Завершення on_startup.
[Refridex OS • DEBUG • 2025-09-18 01:39:28.400] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:39:28.400] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:39:28.400] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:39:28.400] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:39:28.400] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:28.401] 🔹 Стан: handlers.start_handler • Користувач Віталій (ID: 525974549) виконав команду /start.
[Refridex OS • LOGCORE • 2025-09-18 01:39:28.403] 🔹 Стан: database.users_db • Оновлено last_activity для користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:39:28.404] 🔹 Стан: handlers.start_handler • Оновлено last_activity для існуючого користувача 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:39:28.660] 🔹 Стан: handlers.start_handler • Відправлено привітальне повідомлення користувачу 525974549.
[Refridex OS • LOGCORE • 2025-09-18 01:39:28.660] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) викликав show_main_menu_handler (дія: /start).
[Refridex OS • LOGCORE • 2025-09-18 01:39:28.661] 🔹 Стан: handlers.menu_handler • Користувач Віталій Дзюба (ID: 525974549) має рівень доступу: 10.
[Refridex OS • LOGCORE • 2025-09-18 01:39:28.772] 🔹 Стан: handlers.start_handler • Відображено головне меню для користувача 525974549.
[Refridex OS • DEBUG • 2025-09-18 01:39:30.190] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:39:30.190] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:39:30.190] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:39:30.190] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:39:30.190] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:30.191] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:30.395] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:39:33.072] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:39:33.072] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:39:33.072] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:39:33.072] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:39:33.072] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:33.072] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) повернувся в головне меню.
[Refridex OS • DEBUG • 2025-09-18 01:39:34.930] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:39:34.931] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:39:34.931] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:39:34.931] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:39:34.931] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:34.932] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) натиснув кнопку '📚 Каталог'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:35.125] 🔹 Стан: handlers.catalog_handler • Видалено тимчасове повідомлення для приховування клавіатури.
[Refridex OS • DEBUG • 2025-09-18 01:39:36.670] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:39:36.670] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:39:36.670] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:39:36.670] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:39:36.670] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:36.671] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:39:37.754] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:39:37.754] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:39:37.754] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:39:37.754] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:39:37.754] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:37.860] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) обрав модель з ID: 1.
[Refridex OS • DEBUG • 2025-09-18 01:39:39.821] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:39:39.821] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:39:39.821] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:39:39.821] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:39:39.821] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:39.822] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) вибрав бренд 'NC clima'.
[Refridex OS • DEBUG • 2025-09-18 01:39:41.238] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Обробка події типу Update
[Refridex OS • DEBUG • 2025-09-18 01:39:41.238] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Додано 'db_pool' до 'data'.
[Refridex OS • DEBUG • 2025-09-18 01:39:41.238] 🐞 Відлагодження: middlewares.db_middleware • DbSessionMiddleware: Подія Update не має прямого 'from_user'. Пропускаємо обробку користувача.
[Refridex OS • DEBUG • 2025-09-18 01:39:41.238] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Обробка події Update
[Refridex OS • DEBUG • 2025-09-18 01:39:41.238] 🐞 Відлагодження: middlewares.telethon_middleware • TelethonClientMiddleware: Додано 'telethon_manager' до 'data'.
[Refridex OS • LOGCORE • 2025-09-18 01:39:41.239] 🔹 Стан: handlers.catalog_handler • Користувач Віталій Дзюба (ID: 525974549) повернувся в головне меню.
[Refridex OS • УВАГА • 2025-09-18 01:41:10.648] ⚠️ Попередження: aiogram.dispatcher • Received SIGINT signal
[Refridex OS • LOGCORE • 2025-09-18 01:41:10.649] 🔹 Стан: __main__ • Початок завершення роботи бота. Зареєстровані shutdown-хуки виконуються.
[Refridex OS • LOGCORE • 2025-09-18 01:41:10.649] 🔹 Стан: __main__ • Спроба відключити Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:41:10.649] 🔹 Стан: telegram_client_module.telethon_client • Початок відключення всіх Telethon клієнтів.
[Refridex OS • LOGCORE • 2025-09-18 01:41:10.650] 🔹 Стан: telegram_client_module.telethon_client • Telethon клієнт для 380997751324 відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:41:10.651] 🔹 Стан: telegram_client_module.telethon_client • Усі Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:41:10.651] 🔹 Стан: __main__ • Telethon клієнти відключено.
[Refridex OS • LOGCORE • 2025-09-18 01:41:10.651] 🔹 Стан: __main__ • Спроба закрити пул підключень до бази даних.
[Refridex OS • LOGCORE • 2025-09-18 01:41:10.656] 🔹 Стан: database.db_pool_manager • Пул з'єднань до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:41:10.657] 🔹 Стан: __main__ • Пул підключень до бази даних закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:41:10.657] 🔹 Стан: __main__ • Закриття сесію бота.
[Refridex OS • LOGCORE • 2025-09-18 01:41:10.909] 🔹 Стан: __main__ • Сесію бота закрито.
[Refridex OS • LOGCORE • 2025-09-18 01:41:10.911] 🔹 Стан: __main__ • dp.start_polling завершив роботу.
[Refridex OS • LOGCORE • 2025-09-18 01:41:10.913] 🔹 Стан: __main__ • Система: процес завершено. Вихід з потоку.
